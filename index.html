<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Agenda Personale Completa</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Lexend&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; }
body {
  font-family: 'Lexend', sans-serif;
  background: linear-gradient(135deg, #4facfe, #00f2fe);
  color: #222;
  margin: 0; padding: 20px;
  display: flex; flex-direction: column; align-items: center;
}
h1 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 10vw;
  color: #0a1d5d; 
  text-shadow: 3px 3px 6px rgba(255, 235, 59, 0.5); 
  letter-spacing: 1px;
  display: flex; align-items: center; justify-content: center;
  text-align: center; background: rgba(255,255,255,0.15);
  backdrop-filter: blur(8px); padding: 20px 15px; border-radius: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  margin: 0 0 30px 0; width: 95%; max-width: 800px; 
  word-wrap: break-word;
}
.card {
  font-family: 'Lexend', sans-serif;
  background: #fff; border-radius: 16px; padding: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  margin-bottom: 20px; width: 100%; max-width: 800px;
  display: flex; flex-direction: column; align-items: center; text-align: center;
}
button {
  font-family: 'Lexend', sans-serif; background: #4facfe;
  color: white; border: none; padding: 12px 18px; font-size: 16px;
  border-radius: 10px; cursor: pointer; transition: background 0.3s;
  margin-top: 10px; width: 100%;
  max-width: 200px; text-align: center;
}
button:hover { background: #008cff; }
#status, #micStatus { margin-top: 10px; font-style: italic; color: #555; width: 100%; text-align: center; }

input[type="text"], textarea { text-align: center; width: 100%; margin-top: 5px; border: 1px solid #ccc; border-radius: 8px; padding: 8px; outline: none; }

ul { list-style: none; padding: 0; width: 100%; }
li {
  background: #f9f9f9; padding: 10px 14px; margin: 8px 0; border-radius: 10px;
  display: flex; justify-content: center; align-items: center; text-align: center;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
}
.delete { color: #ff4444; font-weight: bold; cursor: pointer; font-size: 14px; margin-left: 5px; }

#calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  width: 100%;
  margin-top: 10px;
}
.day {
  background: #f0f0f0;
  border-radius: 10px;
  min-height: 80px;
  padding: 5px;
  cursor: pointer;
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  text-align: center;
  overflow: hidden;
}
.day-number {
  font-weight: bold;
  margin-bottom: 5px;
  font-size: 1em;
}
.day.selected { background: #4facfe; color: white; }
.promemoria-item {
  font-size: 0.7em;
  background: #ffeb3b;
  color: #000;
  border-radius: 4px;
  padding: 2px 4px;
  margin: 2px 0;
  width: 100%;
  text-align: center;
  overflow-wrap: break-word;
}
</style>
</head>
<body>
<h1>Agenda Personale</h1>

<!-- REGISTRA PROMEMORIA -->
<div class="card">
  <button id="recordBtn">Registra promemoria</button>
  <div id="status"></div>
  <textarea id="manualPromemoria" rows="3" placeholder="Scrivi manualmente il promemoria se il microfono non funziona..."></textarea>
  <button id="manualPromemoriaBtn">Aggiungi manualmente</button>
</div>

<!-- CALENDARIO -->
<div class="card">
  <h2>Calendario</h2>
  <div id="calendar"></div>
</div>

<!-- PROMEMORIA LISTA -->
<div class="card">
  <h2>Promemoria</h2>
  <ul id="promemoriaList"></ul>
</div>

<!-- LISTA DELLA SPESA -->
<div class="card">
  <h2>Lista della Spesa</h2>
  <input type="text" id="itemInput" placeholder="Aggiungi prodotto con voce...">
  <button id="micBtn">ðŸŽ¤ Detti prodotto</button>
  <span id="micStatus" style="display:none; color:green; font-weight:bold; margin-top:5px;">ðŸŽ§ Ascolto...</span>
  <button id="addBtn">Aggiungi</button>

  <textarea id="manualInput" rows="3" placeholder="Scrivi qui i prodotti manualmente, separati da virgola o a capo..."></textarea>
  <button id="manualAddBtn">Aggiungi manualmente</button>

  <button id="shareBtn">Condividi lista su WhatsApp</button>
  <ul id="shoppingList"></ul>
</div>

<script>
const recordBtn = document.getElementById('recordBtn');
const status = document.getElementById('status');
const calendarDiv = document.getElementById('calendar');
const promemoriaList = document.getElementById('promemoriaList');
const manualPromemoria = document.getElementById('manualPromemoria');
const manualPromemoriaBtn = document.getElementById('manualPromemoriaBtn');

const itemInput = document.getElementById('itemInput');
const micBtn = document.getElementById('micBtn');
const micStatus = document.getElementById('micStatus');
const addBtn = document.getElementById('addBtn');
const manualInput = document.getElementById('manualInput');
const manualAddBtn = document.getElementById('manualAddBtn');
const shareBtn = document.getElementById('shareBtn');
const shoppingListUl = document.getElementById('shoppingList');

let recognition;
let promemoria = JSON.parse(localStorage.getItem('promemoria') || '[]');
let shoppingList = JSON.parse(localStorage.getItem('shoppingList') || '[]');
let selectedDay = null;

// CALENDARIO
function createCalendar() {
  calendarDiv.innerHTML = '';
  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth();
  const firstDay = new Date(year, month, 1).getDay(); 
  const lastDate = new Date(year, month+1,0).getDate();
  for(let i=0;i<firstDay;i++){ calendarDiv.appendChild(document.createElement('div')); }
  for(let d=1; d<=lastDate; d++){
    const dayDiv = document.createElement('div');
    dayDiv.className = 'day';
    dayDiv.dataset.day = d;
    dayDiv.innerHTML = `<div class="day-number">${d}</div>`;
    dayDiv.addEventListener('click', ()=>selectDay(dayDiv));
    calendarDiv.appendChild(dayDiv);
  }
  renderPromemoriaInCalendar();
}

function selectDay(dayDiv){
  document.querySelectorAll('.day').forEach(d=>d.classList.remove('selected'));
  dayDiv.classList.add('selected');
  selectedDay = dayDiv.dataset.day;
}

// PROMEMORIA VOCALE
function startRecognition(){
  if(!selectedDay){ alert("Seleziona un giorno nel calendario!"); return; }
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRecognition){ alert("Browser non supporta riconoscimento vocale."); return; }

  recognition = new SpeechRecognition();
  recognition.lang = "it-IT";
  recognition.onstart = ()=>status.textContent = "ðŸŽ§ Ascolto...";
  recognition.onerror = e=>status.textContent = "Errore: "+e.error;
  recognition.onend = ()=>status.textContent = "";
  recognition.onresult = e=>{
    const testo = e.results[0][0].transcript;
    const numero = promemoria.length + 1;
    promemoria.push({day:selectedDay,text:testo});
    localStorage.setItem('promemoria',JSON.stringify(promemoria));
    renderPromemoria();
    renderPromemoriaInCalendar();
  };
  recognition.start();
}

// LISTA DELLA SPESA
function addItem(text){
  shoppingList.push(text);
  localStorage.setItem('shoppingList',JSON.stringify(shoppingList));
  renderList();
}

function renderList(){
  shoppingListUl.innerHTML = '';
  shoppingList.forEach((item,i)=>{
    const li = document.createElement('li');
    li.textContent = item;
    const del = document.createElement('span');
    del.textContent = 'âœ–';
    del.className='delete';
    del.onclick = ()=>{ shoppingList.splice(i,1); localStorage.setItem('shoppingList',JSON.stringify(shoppingList)); renderList();}
    li.appendChild(del);
    shoppingListUl.appendChild(li);
  });
}

// PROMEMORIA
function renderPromemoria(){
  promemoriaList.innerHTML='';
  promemoria.forEach((p,i)=>{
    const li=document.createElement('li');
    li.textContent=`[Giorno ${p.day}] ${p.text}`;
    promemoriaList.appendChild(li);
  });
}

function renderPromemoriaInCalendar(){
  document.querySelectorAll('.day').forEach(d=>{
    d.querySelectorAll('.promemoria-item').forEach(n=>n.remove());
    const day = d.dataset.day;
    promemoria.filter(p=>p.day==day).forEach(p=>{
      const div = document.createElement('div');
      div.className='promemoria-item';
      div.textContent=p.text;
      d.appendChild(div);
    });
  });
}

// EVENTI
recordBtn.addEventListener('click', startRecognition);
manualPromemoriaBtn.addEventListener('click',()=>{
  if(!selectedDay){ alert("Seleziona un giorno nel calendario!"); return; }
  const testo = manualPromemoria.value.trim();
  if(testo){ promemoria.push({day:selectedDay,text:testo}); localStorage.setItem('promemoria',JSON.stringify(promemoria)); manualPromemoria.value=''; renderPromemoria(); renderPromemoriaInCalendar();}
});

addBtn.addEventListener('click',()=>{ const val = itemInput.value.trim(); if(val){ addItem(val); itemInput.value=''; }});
manualAddBtn.addEventListener('click', ()=>{ manualInput.value.split(/\n|,/).map(v=>v.trim()).filter(v=>v).forEach(v=>addItem(v)); manualInput.value=''; });

// Condivisione WhatsApp
shareBtn.addEventListener('click', ()=>{
  if(shoppingList.length===0){ alert("Lista vuota!"); return; }
  const text = encodeURIComponent(shoppingList.join('\n'));
  const url = `https://wa.me/?text=${text}`;
  window.open(url,'_blank');
});

// Microfono lista
micBtn.addEventListener('click', ()=>{
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRecognition){ alert("Browser non supporta riconoscimento vocale."); return; }
  micStatus.style.display="inline";
  const micRec = new SpeechRecognition();
  micRec.lang="it-IT";
  micRec.interimResults=true;
  micRec.onresult=e=>{
    let interim='';
    for(let i=e.resultIndex;i<e.results.length;i++){
      if(e.results[i].isFinal){ addItem(e.results[i][0].transcript); itemInput.value=''; }
      else{ interim+=e.results[i][0].transcript; }
    }
    itemInput.value=interim;
  };
  micRec.onend=()=>{ micStatus.style.display="none"; }
  micRec.onerror=e=>{ micStatus.style.display="none"; alert("Errore microfono: "+e.error); }
  micRec.start();
});

// Avvio
createCalendar();
renderPromemoria();
renderList();
</script>
</body>
</html>
