<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Agenda Personale Completa</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Lexend&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; }
body {
  font-family: 'Lexend', sans-serif;
  background: linear-gradient(135deg, #4facfe, #00f2fe);
  color: #222;
  margin: 0; padding: 20px;
  display: flex; flex-direction: column; align-items: center;
}
h1 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 10vw; /* font responsive */
  color: #0a1d5d; 
  text-shadow: 3px 3px 6px rgba(255, 235, 59, 0.5); 
  letter-spacing: 1px;
  display: flex; align-items: center; justify-content: center;
  text-align: center; background: rgba(255,255,255,0.15);
  backdrop-filter: blur(8px); padding: 20px 15px; border-radius: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  margin: 0 0 30px 0; width: 95%; max-width: 800px; 
  word-wrap: break-word;
}
.card {
  font-family: 'Lexend', sans-serif;
  background: #fff; border-radius: 16px; padding: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  margin-bottom: 20px; width: 100%; max-width: 800px;
  display: flex; flex-direction: column; align-items: center; text-align: center;
}
button {
  font-family: 'Lexend', sans-serif; background: #4facfe;
  color: white; border: none; padding: 12px 18px; font-size: 16px;
  border-radius: 10px; cursor: pointer; transition: background 0.3s;
  margin-top: 10px; width: 100%;
  max-width: 200px; text-align: center;
}
button:hover { background: #008cff; }
#status, #micStatus { margin-top: 10px; font-style: italic; color: #555; width: 100%; text-align: center; }

input[type="text"], textarea { text-align: center; width: 100%; margin-top: 5px; border: 1px solid #ccc; border-radius: 8px; padding: 8px; outline: none; }

ul { list-style: none; padding: 0; width: 100%; }
li {
  background: #f9f9f9; padding: 10px 14px; margin: 8px 0; border-radius: 10px;
  display: flex; justify-content: center; align-items: center; text-align: center;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
}
.delete { color: #ff4444; font-weight: bold; cursor: pointer; font-size: 14px; margin-left: 5px; }

#calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; width: 100%; margin-top: 10px; }
.day { background: #f0f0f0; border-radius: 10px; padding: 10px; min-height: 80px; cursor: pointer; position: relative; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; }
.day.selected { background: #4facfe; color: white; }
.day-number { font-weight: bold; margin-bottom: 5px; }
.promemoria-item { font-size: 0.75em; background: #ffeb3b; color: #000; border-radius: 4px; padding: 2px 4px; margin: 2px 0; width: 100%; text-align: center; }
</style>
</head>
<body>
<h1>Agenda Personale</h1>

<!-- REGISTRA PROMEMORIA -->
<div class="card">
  <button id="recordBtn">Registra promemoria</button>
  <div id="status"></div>

  <!-- Input manuale -->
  <textarea id="manualPromemoria" rows="3" placeholder="Scrivi manualmente il promemoria se il microfono non funziona..."></textarea>
  <button id="manualPromemoriaBtn">Aggiungi manualmente</button>
</div>

<!-- CALENDARIO -->
<div class="card">
  <h2>Calendario</h2>
  <div id="calendar"></div>
</div>

<!-- PROMEMORIA LISTA -->
<div class="card">
  <h2>Promemoria</h2>
  <ul id="promemoriaList"></ul>
</div>

<!-- LISTA DELLA SPESA -->
<div class="card">
  <h2>Lista della Spesa</h2>

  <!-- Input microfono -->
  <input type="text" id="itemInput" placeholder="Aggiungi prodotto con voce...">
  <button id="micBtn">ðŸŽ¤ Detti prodotto</button>
  <span id="micStatus" style="display:none; color:green; font-weight:bold; margin-top:5px;">ðŸŽ§ Ascolto...</span>
  <button id="addBtn">Aggiungi</button>

  <!-- Input manuale -->
  <textarea id="manualInput" rows="3" placeholder="Scrivi qui i prodotti manualmente, separati da virgola o a capo..."></textarea>
  <button id="manualAddBtn">Aggiungi manualmente</button>

  <button id="shareBtn">Condividi lista</button>
  <ul id="shoppingList"></ul>
</div>

<script>
const recordBtn = document.getElementById('recordBtn');
const status = document.getElementById('status');
const calendarDiv = document.getElementById('calendar');
const promemoriaList = document.getElementById('promemoriaList');
const manualPromemoria = document.getElementById('manualPromemoria');
const manualPromemoriaBtn = document.getElementById('manualPromemoriaBtn');

const itemInput = document.getElementById('itemInput');
const micBtn = document.getElementById('micBtn');
const micStatus = document.getElementById('micStatus');
const addBtn = document.getElementById('addBtn');
const manualInput = document.getElementById('manualInput');
const manualAddBtn = document.getElementById('manualAddBtn');
const shareBtn = document.getElementById('shareBtn');
const shoppingListUl = document.getElementById('shoppingList');

let recognition;
let promemoria = JSON.parse(localStorage.getItem('promemoria') || '[]');
let shoppingList = JSON.parse(localStorage.getItem('shoppingList') || '[]');
let selectedDay = null;

// CREA CALENDARIO
function createCalendar() {
  calendarDiv.innerHTML = '';
  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth();
  const firstDay = new Date(year, month, 1).getDay(); 
  const lastDate = new Date(year, month+1,0).getDate();

  for(let i=0;i<firstDay;i++){ calendarDiv.appendChild(document.createElement('div')); }

  for(let d=1; d<=lastDate; d++){
    const dayDiv = document.createElement('div');
    dayDiv.className = 'day';
    dayDiv.dataset.day = d;
    dayDiv.innerHTML = `<div class="day-number">${d}</div>`;
    dayDiv.addEventListener('click', ()=>selectDay(dayDiv));
    calendarDiv.appendChild(dayDiv);
  }
  renderPromemoriaInCalendar();
}

function selectDay(dayDiv){
  document.querySelectorAll('.day').forEach(d=>d.classList.remove('selected'));
  dayDiv.classList.add('selected');
  selectedDay = dayDiv.dataset.day;
}

// REGISTRA PROMEMORIA VOCALE
function startRecognition(){
  if(!selectedDay){ alert("Seleziona un giorno nel calendario!"); return; }
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRecognition){ alert("Browser non supporta riconoscimento vocale."); return; }

  recognition = new SpeechRecognition();
  recognition.lang = "it-IT";
  recognition.onstart = ()=>status.textContent = "ðŸŽ§ Ascolto...";
  recognition.onerror = e=>status.textContent = "Errore: "+e.error;
  recognition.onend = ()=>status.textContent = "";
  recognition.onresult = e=>{
    const testo = e.results[0][0].transcript;
    const numero = promemoria.length + 1;
    promemoria.push({ numero, testo, giorno: selectedDay });
    localStorage.setItem('promemoria', JSON.stringify(promemoria));
    renderPromemoria();
    renderPromemoriaInCalendar();
    alert("Nuovo promemoria #" + numero);
  };
  recognition.start();
}

// AGGIUNGI PROMEMORIA MANUALE
manualPromemoriaBtn.addEventListener('click', ()=>{
  if(!selectedDay){ alert("Seleziona un giorno nel calendario!"); return; }
  const testo = manualPromemoria.value.trim();
  if(!testo) return;
  const numero = promemoria.length + 1;
  promemoria.push({ numero, testo, giorno: selectedDay });
  localStorage.setItem('promemoria', JSON.stringify(promemoria));
  renderPromemoria();
  renderPromemoriaInCalendar();
  manualPromemoria.value = '';
});

function renderPromemoria(){
  promemoriaList.innerHTML = '';
  promemoria.forEach(p=>{
    const li = document.createElement('li');
    li.innerHTML = `#${p.numero} - ${p.testo} (giorno ${p.giorno}) <span class="delete" onclick="delPromemoria(${p.numero-1})">âœ–</span>`;
    promemoriaList.appendChild(li);
  });
}

function renderPromemoriaInCalendar(){
  document.querySelectorAll('.day').forEach(d=>d.querySelectorAll('.promemoria-item').forEach(e=>e.remove()));
  promemoria.forEach(p=>{
    const dayDiv = Array.from(document.querySelectorAll('.day')).find(d=>d.dataset.day==p.giorno);
    if(dayDiv){
      const span = document.createElement('div');
      span.className = 'promemoria-item';
      span.textContent = `#${p.numero}`;
      dayDiv.appendChild(span);
    }
  });
}

function delPromemoria(i){
  promemoria.splice(i,1);
  localStorage.setItem('promemoria', JSON.stringify(promemoria));
  renderPromemoria();
  renderPromemoriaInCalendar();
}

// LISTA DELLA SPESA
function renderList(){
  shoppingListUl.innerHTML = "";
  shoppingList.forEach((item,i)=>{
    const li = document.createElement("li");
    li.innerHTML = `<span>${item}</span><span class="delete" onclick="delItem(${i})">âœ–</span>`;
    shoppingListUl.appendChild(li);
  });
}
function delItem(i){
  shoppingList.splice(i,1);
  localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
  renderList();
}
function addItem(value){
  value = value.trim();
  if(!value) return;
  shoppingList.push(value);
  localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
  renderList();
}

// Aggiungi microfono
addBtn.addEventListener('click', ()=>{ addItem(itemInput.value); itemInput.value=''; });

// Input manuale lista
manualAddBtn.addEventListener('click', ()=>{
  const values = manualInput.value.split(/\n|,/).map(v=>v.trim()).filter(v=>v);
  values.forEach(v=>addItem(v));
  manualInput.value = '';
});

// Condivisione lista
shareBtn.addEventListener('click', ()=>{
  const text = shoppingList.join('\n');
  navigator.clipboard.writeText(text).then(()=>alert("Lista copiata negli appunti!"));
});

// Riconoscimento vocale lista della spesa
micBtn.addEventListener('click', ()=>{
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRecognition){ alert("Browser non supporta riconoscimento vocale."); return; }

  micStatus.style.display = "inline";
  const micRec = new SpeechRecognition();
  micRec.lang = "it-IT";
  micRec.interimResults = true;

  micRec.onresult = e=>{
    let interimTranscript = '';
    for(let i=e.resultIndex;i<e.results.length;i++){
      if(e.results[i].isFinal){
        addItem(e.results[i][0].transcript);
        itemInput.value = "";
      } else {
        interimTranscript += e.results[i][0].transcript;
      }
    }
    itemInput.value = interimTranscript;
  };

  micRec.onend = ()=>{ micStatus.style.display = "none"; }
  micRec.onerror = e=>{ micStatus.style.display = "none"; alert("Errore microfono: "+e.error); }
  micRec.start();
});

// Avvio iniziale
createCalendar();
renderPromemoria();
renderList();
</script>
</body>
</html>
