<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Personale</title>
<style>
  body {
    font-family: 'Lexend', sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .container {
    width: 100%;
    max-width: 900px;
    padding: 10px;
    box-sizing: border-box;
  }
  h1 {
    font-family: 'Lexend', sans-serif;
    font-weight: 700;
    font-size: 3em;
    color: #1a73e8;
    text-align: center;
    margin: 20px auto;
    letter-spacing: 1px;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
  }
  .section {
    width: 100%;
    margin: 20px auto;
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    box-sizing: border-box;
  }
  h2 {
    color: #003366;
    margin-bottom: 15px;
    text-align: center;
  }
  input, textarea {
    width: 100%;
    max-width: 600px;
    padding: 10px;
    margin: 10px auto;
    border: none;
    border-radius: 8px;
    background: #f9f9f9;
    display: block;
    box-sizing: border-box;
  }
  button {
    background: #003366;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    margin: 5px auto;
    display: inline-block;
  }
  ul {
    list-style: none;
    padding: 0;
    margin: 0 auto;
    max-width: 600px;
    text-align: left;
  }
  ul li {
    background: #e9ecef;
    margin: 5px 0;
    padding: 8px;
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    word-break: break-word;
  }
  .delete-btn {
    background: #dc3545;
    border: none;
    padding: 5px 8px;
    color: white;
    border-radius: 6px;
    cursor: pointer;
  }
  .share-btn { background: #28a745; }

  /* Calendario */
  .calendar-container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    max-width: 600px;
    margin-bottom: 10px;
  }
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    width: 100%;
    max-width: 600px;
  }
  .day-name {
    font-weight: bold;
    color: #003366;
    text-align: center;
    aspect-ratio: 1/1;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .day {
    background: #e9ecef;
    border-radius: 8px;
    aspect-ratio: 1/1;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: 0.2s;
    font-size: 0.9em;
    position: relative;
  }
  .day:hover { background: #d6e4ff; }
  .has-event { background: #ffd966; }
  .event-dot {
    width: 8px;
    height: 8px;
    background: red;
    border-radius: 50%;
    position: absolute;
    bottom: 5px;
    right: 5px;
  }

  /* Modale */
  #eventModal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
  }
  #eventModal .modal-content {
    background: white;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    width: 90%;
    max-width: 400px;
  }

  @media(max-width:600px){
    h1 { font-size: 2.2em; }
    input, textarea { max-width: 100%; }
    ul { max-width: 100%; }
    .calendar-header, .calendar-grid { max-width: 100%; }
  }
</style>
</head>
<body>
<div class="container">
  <h1>Agenda</h1>

  <!-- PROMEMORIA -->
  <div class="section">
    <h2>Registra Promemoria</h2>
    <input type="text" id="memoInput" placeholder="Scrivi un promemoria">
    <button onclick="addMemo()">Aggiungi</button>
    <button onclick="startMemoVoice()">🎤</button>
    <ul id="memoList"></ul>
  </div>

  <!-- LISTA SPESA -->
  <div class="section">
    <h2>Lista della Spesa</h2>
    <input type="text" id="shoppingInput" placeholder="Aggiungi prodotto">
    <button onclick="addProduct()">Aggiungi</button>
    <button class="share-btn" onclick="shareList()">Condividi Lista</button>
    <ul id="shoppingList"></ul>
  </div>

  <!-- CALENDARIO -->
  <div class="calendar-container">
    <div class="calendar-header">
      <button onclick="prevMonth()">&#8592;</button>
      <h2 id="monthYear"></h2>
      <button onclick="nextMonth()">&#8594;</button>
    </div>
    <div class="calendar-grid" id="calendar"></div>
  </div>
</div>

<!-- MODALE EVENTI -->
<div id="eventModal">
  <div class="modal-content">
    <h3 id="modalDate"></h3>
    <textarea id="eventText" placeholder="Scrivi promemoria"></textarea>
    <button onclick="saveEvent()">Salva</button>
    <button onclick="closeModal()">Chiudi</button>
  </div>
</div>

<script>
  // PROMEMORIA
  function addMemo() {
    const input = document.getElementById("memoInput");
    if(input.value.trim() === "") return;
    const li = document.createElement("li");
    li.textContent = input.value;
    const delBtn = document.createElement("button");
    delBtn.textContent = "❌";
    delBtn.className = "delete-btn";
    delBtn.onclick = () => li.remove();
    li.appendChild(delBtn);
    document.getElementById("memoList").appendChild(li);
    input.value = "";
  }

  function startMemoVoice() {
    if (!('webkitSpeechRecognition' in window)) { alert("Il tuo browser non supporta il riconoscimento vocale."); return; }
    const recognition = new webkitSpeechRecognition();
    recognition.lang = "it-IT";
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.start();
    recognition.onresult = function(event) {
      const transcript = event.results[0][0].transcript;
      document.getElementById("memoInput").value = transcript;
      addMemo();
    };
    recognition.onerror = function() { alert("Errore nel riconoscimento vocale."); };
  }

  // LISTA SPESA
  function addProduct() {
    const input = document.getElementById("shoppingInput");
    if(input.value.trim() === "") return;
    const li = document.createElement("li");
    li.textContent = input.value;
    const delBtn = document.createElement("button");
    delBtn.textContent = "❌";
    delBtn.className = "delete-btn";
    delBtn.onclick = () => li.remove();
    li.appendChild(delBtn);
    document.getElementById("shoppingList").appendChild(li);
    input.value = "";
  }

  function shareList() {
    const items = document.querySelectorAll("#shoppingList li");
    if(items.length === 0) { alert("La lista è vuota!"); return; }
    let text = "Lista della spesa:\n";
    items.forEach(li => text += "- " + li.firstChild.textContent + "\n");
    const url = "https://wa.me/?text=" + encodeURIComponent(text);
    window.open(url, "_blank");
  }

  // CALENDARIO
  let currentDate = new Date();
  let events = {};

  function renderCalendar() {
    const month = currentDate.getMonth();
    const year = currentDate.getFullYear();
    document.getElementById('monthYear').textContent =
      currentDate.toLocaleString('it-IT', { month: 'long', year: 'numeric' });

    const firstDay = new Date(year, month, 1).getDay() || 7;
    const daysInMonth = new Date(year, month+1, 0).getDate();
    const calendar = document.getElementById('calendar');
    calendar.innerHTML = "";

    const days = ["L","M","M","G","V","S","D"];
    days.forEach(d => { 
      const div = document.createElement("div"); 
      div.textContent=d; 
      div.className="day-name"; 
      calendar.appendChild(div); 
    });

    for(let i=1;i<firstDay;i++){ 
      const empty = document.createElement("div"); 
      calendar.appendChild(empty); 
    }

    for(let d=1; d<=daysInMonth; d++){ 
      const div = document.createElement("div"); 
      div.textContent = d; 
      div.className = "day"; 
      const key = `${year}-${month+1}-${d}`; 
      if(events[key]){
        div.classList.add("has-event"); 
        const dot = document.createElement("div"); 
        dot.className = "event-dot"; 
        div.appendChild(dot); 
      }
      div.onclick = () => openModal(key); 
      calendar.appendChild(div); 
    }
  }

  function prevMonth() { currentDate.setMonth(currentDate.getMonth()-1); renderCalendar(); }
  function nextMonth() { currentDate.setMonth(currentDate.getMonth()+1); renderCalendar(); }

  // MODALE EVENTI
  let selectedDate = null;
  function openModal(key){
    selectedDate = key;
    document.getElementById("modalDate").textContent = key;
    document.getElementById("eventText").value = events[key] || "";
    document.getElementById("eventModal").style.display = "flex";
  }
  function closeModal(){ document.getElementById("eventModal").style.display = "none"; }
  function saveEvent(){
    const text = document.getElementById("eventText").value.trim();
    if(text) events[selectedDate] = text;
    else delete events[selectedDate];
    closeModal();
    renderCalendar();
  }

  renderCalendar();
</script>
</body>
</html>
